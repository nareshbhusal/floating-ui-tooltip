!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("tslib"),require("@floating-ui/dom")):"function"==typeof define&&define.amd?define(["tslib","@floating-ui/dom"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["floating-ui-tooltip"]=e(t.tslib,t.dom)}(this,(function(t,e){"use strict";function i(t,e,i){var o=e+"EventListener";["transitionend","webkitTransitionEnd","oTransitionEnd"].forEach((function(e){t[o](e,i)}))}function o(t,e){t.setAttribute("data-transition-state",e),console.log(">> new transition state: "+e)}function n(t,e){t.setAttribute("data-state",e),Object.assign(t.style,{visibility:e})}function r(){return document.createElement("div")}function s(t){return{box:t.querySelector(".floating-ui-tooltip-box"),content:t.querySelector(".floating-ui-tooltip-content"),arrow:t.querySelector(".floating-ui-tooltip-arrow")||void 0}}function a(t,e){var r=t._instance,s=t.getAttribute("data-transition-state");if(console.log("``````````"),console.log("\n"),console.log(e,s),"visible"===e){if("shown"===s||"showing"===s)return void console.log("already "+s);if("hidden"===s)console.log("showing"),o(t,"showing");else if("hiding"===s)return void console.log("cancelling "+s)}else{if("hidden"===s||"hiding"===s)return void console.log("already "+s);if("shown"===s)o(t,"hiding"),r.props.onHide(r);else if("showing"===s)return void console.log("cancelling "+s)}var a="visible"===e?"shown":"hidden";0!==r.transitionDuration?(!function(t,e){function o(n){if(n.target===t){i(t,"remove",o);try{e()}catch(e){console.error(e),t._instance.props.onHide()}}}i(t,"remove",o),i(t,"add",o)}(t,(function(){!function(t,e){t._instance.setState({isShown:"visible"===e})}(t,e),o(t,a),"visible"===e&&r.props.onShow(r)})),n(t,e)):(n(t,e),o(t,a),"visible"===e&&r.props.onShow(r))}var l={top:"bottom",right:"left",bottom:"top",left:"right"},d=function(t){var e,i,o,n=t.passedPlacement,r=t.tooltipElement,s=t.toResetPosition,a=n.orientation,l=null===(e=r._instance.state.fui)||void 0===e?void 0:e.placement;return l?s?(i=r.getBoundingClientRect(),o=document.documentElement.getBoundingClientRect(),(i.top<o.top||i.bottom>o.bottom||i.left<o.left||i.right>o.right)&&(console.log("tooltip overflown"),"auto"===a)?"auto":l):l:n.position},c=function(i){var o=i.passedPlacement,n=i.toResetPosition,r=i.passedOffset,s=i.resetPlacementOnUpdate,a=i.newlyShown,l=i.toShift,c=i.toShowArrow,p=i.arrowElement,u=i.tooltipElement,h=i.target;return t.__awaiter(void 0,void 0,void 0,(function(){var i,f,g,w;return t.__generator(this,(function(v){switch(v.label){case 0:return i=d({passedPlacement:o,tooltipElement:u,toResetPosition:n}),f="auto"===i&&(a||s),g=l&&a,w=t.__assign(t.__assign({},"auto"!==i&&{placement:i}),{middleware:t.__spreadArray(t.__spreadArray(t.__spreadArray(t.__spreadArray([e.offset({mainAxis:r[0],crossAxis:r[1]})],f?[e.autoPlacement()]:[],!0),g?[e.shift({padding:16})]:[],!0),c?[e.arrow({element:p,padding:2})]:[],!0),[e.size({apply:function(t){t.width,t.height,t.reference,t.floating}}),e.hide()],!1)}),[4,e.computePosition(h,u,w)];case 1:return[2,v.sent()]}}))}))},p=function(e,i,o,n,r,d){return t.__awaiter(void 0,void 0,void 0,(function(){var p,u,h,f,g,w,v,m,b,x,_,y,E,S;return t.__generator(this,(function(t){switch(t.label){case 0:return u=void 0===(p={}.toShift)||p,h=e.placement,f=e.hideOnReferenceHidden,g=e.offset,w=e.hideOnTooltipEscape,v=e.arrowSizeScale,m=e.resetPlacementOnUpdate,b=e.arrow,x=e.scrollIntoView,_=e.showOnCreate,y=s(i).arrow,E=!i._instance.getState().fui,o?[4,c({passedPlacement:h,toResetPosition:r,passedOffset:g,resetPlacementOnUpdate:m,toShift:u,toShowArrow:b,arrowElement:y,tooltipElement:i,target:o,newlyShown:E})]:[2,console.warn("target element not found")];case 1:return function(t){var e,i,o,n=t.fui,r=t.newlyShown,s=t.scrollIntoView,d=t.hideOnReferenceHidden,c=t.hideOnTooltipEscape,p=t.tooltipElement,u=t.arrowElement,h=t.target,f=t.toHide,g=t.showOnCreate,w=t.arrowSizeScale,v=n.x,m=n.y,b=n.placement,x=n.middlewareData,_=x.hide,y=_.referenceHidden,E=_.escaped;y&&r&&s&&h.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),x.arrow&&(i=x.arrow.x,o=x.arrow.y);var S=0!==x.arrow.centerOffset,O=d&&y||c&&E||f?"hidden":"visible";console.log("to change visibility to: "+O),"visible"===O&&r&&!g&&(O="hidden"),a(p,O),Object.assign(p.style,{left:v+"px",top:m+"px"});var C=12*w;console.log("size scale: "+w),console.log("arrow size: "+C);var T=l[b.split("-")[0]],k=0,H=0,R=0;switch(R=null!==i?i+C+"px":"",T){case"top":k=1/1.7,R=null!==i?i+C*k+"px":"";break;case"bottom":k=.5,R=null!==i?i+C*k+"px":"";break;case"left":k=.005,R=null!==i?i+"px":"",H=null!==o?o-C*k/2+"px":"";break;case"right":k=1.2,R=null!==i?i+"px":"",H=null!==o?o-C*k/2+"px":""}H=null!==o?o-C*k/2+"px":"",H=null!==o?o+"px":"",Object.assign(u.style,((e={visibility:S?"hidden":"visible",left:R,top:H,right:"",bottom:"",width:C+"px",height:C+"px"})[T]="-"+C*k+"px",e))}({fui:S=t.sent(),newlyShown:E,scrollIntoView:x,hideOnReferenceHidden:f,hideOnTooltipEscape:w,tooltipElement:i,arrowElement:y,target:o,toHide:n,showOnCreate:_,arrowSizeScale:v}),d({fui:S}),[2,S]}}))}))},u={allowHTML:!0,content:"",arrow:!0,scrollIntoView:!1,transitionDuration:[300,250],offset:[10,0],hideOnClick:!0,onClickOutside:function(t,e){},onShow:function(t){},onHide:function(t){},onStateChange:function(t,e){},onRemove:function(){},onBeforeFirstRender:function(){},onAfterFirstRender:function(){},placement:{position:"top",orientation:"fixed"},resetPlacementOnUpdate:!1,hideOnTooltipEscape:!0,hideOnReferenceHidden:!0,showOnCreate:!0,maxWidth:350,updateDebounce:100,zIndex:99999,arrowSizeScale:1,updateOnEvents:"resize scroll"};var h=function(){function i(t,e){var i,o=this;this.state={isShown:!1,isRemoved:!1,fui:void 0},this.updateListenerCleanup=function(){},this.toHideTooltip=!1,this.transitionDuration=0,this.clickHandler=function(t){o.state.isShown&&(o.tooltipElement.contains(t.target)||o.reference.contains(t.target)||o.props.onClickOutside&&o.props.onClickOutside(o,t),"target"===o.props.hideOnClick?t.target===o.reference&&o.hide():o.props.hideOnClick&&o.hide())},this.props=t,this.reference=e,window.tp=this,(i=document.createElement("style")).type="text/css",i.setAttribute("floating-ui-tooltip-default",""),i.textContent=".floating-ui-tooltip-root{--color:#fff;--border-color:#fefefe;--border-color:red;backface-visibility:hidden;background:var(--color);border-radius:6px;box-shadow:0 0 0 1px rgba(6,44,82,.1),0 2px 16px rgba(33,43,54,.08);box-shadow:0 0 20px 4px rgba(154,161,177,.15),0 4px 80px -8px rgba(36,40,47,.25),0 4px 4px -2px rgba(91,94,105,.15);display:flex;font-size:90%;line-height:0px;margin:0;max-width:calc(100vw - 10px);padding:0;position:absolute;transition-duration:.2s;transition-property:transform,visibility,opacity;transition-timing-function:cubic-bezier(.54,1.5,.38,1.11);z-index:9999}.floating-ui-tooltip-arrow{box-shadow:0 0 0 1px rgba(6,44,82,.1),0 2px 16px rgba(33,43,54,.08);height:14px;position:absolute;transform:translateX(-50%) rotate(45deg);width:14px;z-index:-1}.floating-ui-tooltip-box{border-radius:inherit;line-height:normal;margin:0;outline:0;position:relative}.floating-ui-tooltip-root[data-state=hidden]{opacity:0}.floating-ui-tooltip-root[data-state=visible]{opacity:1}.floating-ui-tooltip-content{background-color:#fff;border-radius:inherit;color:#111;padding:0;position:relative;z-index:2}.floating-ui-tooltip-arrow,.floating-ui-tooltip-root{background:var(--color)}",document.head.appendChild(i),this.toHideTooltip=!this.props.showOnCreate}return i.prototype.hookEventListeners=function(){var t,i,o,n=this;this.debouncedUpdate=(t=this.update.bind(this),0===(i=this.props.updateDebounce)?t:function(e){clearTimeout(o),o=setTimeout((function(){t(e)}),i)});var r=e.autoUpdate(this.reference,this.tooltipElement,(function(){return n.debouncedUpdate(void 0)})),s=function(){return n.debouncedUpdate(void 0)};this.props.updateOnEvents.split(" ").forEach((function(t){window.addEventListener(t,s)})),window.addEventListener("click",this.clickHandler.bind(this)),this.updateListenerCleanup=function(){r(),window.removeEventListener("click",n.clickHandler.bind(n)),n.props.updateOnEvents.split(" ").forEach((function(t){window.removeEventListener(t,s)}))}},i.prototype.updateTransitionDuration=function(t){this.transitionDuration=t,this.tooltipElement.style.transitionDuration=t+"ms"},i.prototype.create=function(){return t.__awaiter(this,void 0,void 0,(function(){var e,i,a,l,d,c=this;return t.__generator(this,(function(u){switch(u.label){case 0:return this.tooltipElement=(h=this,f=r(),g=r(),w=r(),v=r(),f.className="floating-ui-tooltip-root",g.className="floating-ui-tooltip-box",w.className="floating-ui-tooltip-content",v.className="floating-ui-tooltip-arrow",g.appendChild(w),g.appendChild(v),f.appendChild(g),Object.assign(w.style,{maxWidth:h.props.maxWidth+"px"}),g.setAttribute("role","tooltip"),n(f,"hidden"),o(f,"hidden"),Object.assign(f.style,{zIndex:h.props.zIndex,visibility:"hidden",left:"0px",top:"0px"}),f._instance=h,f),this.updateTransitionDuration(this.props.transitionDuration[this.toHideTooltip?0:1]),e=s(this.tooltipElement).content,i=this.props,a=i.allowHTML,l=i.content,a?l instanceof Element?e.appendChild(l):e.innerHTML=l:l instanceof Element||(e.innerText=l),document.body.appendChild(this.tooltipElement),this.props.onBeforeFirstRender(),d=function(){return t.__awaiter(c,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return[4,p(this.props,this.tooltipElement,this.reference,this.toHideTooltip,!0,this.setState.bind(this))];case 1:case 2:return t.sent(),[4,this.update(!1,!0)];case 3:return t.sent(),this.hookEventListeners(),[2]}}))}))},[4,d()];case 1:return u.sent(),this.props.showOnCreate?[4,this.show()]:[3,3];case 2:return u.sent(),[3,5];case 3:return[4,this.hide()];case 4:u.sent(),u.label=5;case 5:return this.props.onAfterFirstRender(),[2]}var h,f,g,w,v}))}))},i.prototype.getState=function(){return this.state},i.prototype.setState=function(e){void 0!==e.isShown&&e.isShown!==this.state.isShown&&this.updateTransitionDuration(this.props.transitionDuration[e.isShown?1:0]),this.props.onStateChange(this.state,e),this.state=t.__assign(t.__assign({},this.state),e)},i.prototype.update=function(e,i){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return e=e||this.toHideTooltip||!1,[4,p(this.props,this.tooltipElement,this.reference,e,i,this.setState.bind(this))];case 1:return t.sent(),[2]}}))}))},i.prototype.hide=function(){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return this.toHideTooltip=!0,[4,this.update(!0)];case 1:return t.sent(),[2]}}))}))},i.prototype.show=function(){return t.__awaiter(this,void 0,void 0,(function(){return t.__generator(this,(function(t){switch(t.label){case 0:return this.toHideTooltip=!1,[4,this.update(!1)];case 1:return t.sent(),[2]}}))}))},i.prototype.remove=function(){this.tooltipElement.remove(),this.state={isShown:!1,isRemoved:!0,fui:void 0},this.updateListenerCleanup(),console.log("removed all event listeners and observers"),this.props.onRemove()},i}();return function(e,i){return t.__awaiter(this,void 0,void 0,(function(){var o,n,r,s,a;return t.__generator(this,(function(l){switch(l.label){case 0:return o=i.placement||u.placement,n=i.transitionDuration||u.transitionDuration,r=i.offset||u.offset,Object.keys(i).forEach((function(t){return void 0===i[t]&&delete i[t]})),s=t.__assign(t.__assign(t.__assign({},u),i),{placement:o,transitionDuration:n,offset:r}),[4,(a=new h(s,e)).create()];case 1:return l.sent(),[2,{props:a.props,reference:a.reference,tooltipElement:a.tooltipElement,getState:a.getState.bind(a),show:a.show.bind(a),hide:a.hide.bind(a),remove:a.remove.bind(a),update:a.update.bind(a)}]}}))}))}}));
//# sourceMappingURL=index.js.map
