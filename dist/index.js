!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("tslib"),require("@floating-ui/dom")):"function"==typeof define&&define.amd?define(["exports","tslib","@floating-ui/dom"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["floating-ui-tooltip"]={},t.tslib,t.dom)}(this,(function(t,e,i){"use strict";function o(t,e,i){var o=e+"EventListener";["transitionend","webkitTransitionEnd","oTransitionEnd"].forEach((function(e){t[o](e,i)}))}function n(t,e){t.setAttribute("data-transition-state",e),console.log(">> new transition state: "+e)}function r(t,e){t.setAttribute("data-state",e),Object.assign(t.style,{visibility:e})}function s(){return document.createElement("div")}function a(t){return{box:t.querySelector(".floating-ui-tooltip-box"),content:t.querySelector(".floating-ui-tooltip-content"),arrow:t.querySelector(".floating-ui-tooltip-arrow")||void 0}}function l(t,e){var i=t._instance,s=t.getAttribute("data-transition-state");if(console.log("``````````"),console.log("\n"),console.log(e,s),"visible"===e){if("shown"===s||"showing"===s)return void console.log("already "+s);if("hidden"===s)console.log("showing"),n(t,"showing");else if("hiding"===s)return void console.log("cancelling "+s)}else{if("hidden"===s||"hiding"===s)return void console.log("already "+s);if("shown"===s)n(t,"hiding"),i.props.onHide(i);else if("showing"===s)return void console.log("cancelling "+s)}var a="visible"===e?"shown":"hidden";0!==i.transitionDuration?(!function(t,e){function i(n){if(n.target===t){o(t,"remove",i);try{e()}catch(e){console.error(e),t._instance.props.onHide()}}}o(t,"remove",i),o(t,"add",i)}(t,(function(){!function(t,e){t._instance.setState({isShown:"visible"===e})}(t,e),n(t,a),"visible"===e&&i.props.onShow(i)})),r(t,e)):(r(t,e),n(t,a),"visible"===e&&i.props.onShow(i))}var c={top:"bottom",right:"left",bottom:"top",left:"right"},d=function(t){var e,i,o,n=t.passedPlacement,r=t.tooltipElement,s=t.toResetPosition,a=n.orientation,l=null===(e=r._instance.state.fui)||void 0===e?void 0:e.placement;return l?s?(i=r.getBoundingClientRect(),o=document.documentElement.getBoundingClientRect(),(i.top<o.top||i.bottom>o.bottom||i.left<o.left||i.right>o.right)&&(console.log("tooltip overflown"),"auto"===a)?"auto":l):l:n.position},p=function(t){var o=t.passedPlacement,n=t.toResetPosition,r=t.passedOffset,s=t.resetPlacementOnUpdate,a=t.newlyShown,l=t.toShift,c=t.toShowArrow,p=t.arrowElement,u=t.tooltipElement,h=t.target;return e.__awaiter(void 0,void 0,void 0,(function(){var t,f,w,g;return e.__generator(this,(function(v){switch(v.label){case 0:return t=d({passedPlacement:o,tooltipElement:u,toResetPosition:n}),f="auto"===t&&(a||s),w=l&&a,g=e.__assign(e.__assign({},"auto"!==t&&{placement:t}),{middleware:e.__spreadArray(e.__spreadArray(e.__spreadArray(e.__spreadArray([i.offset({mainAxis:r[0],crossAxis:r[1]})],f?[i.autoPlacement()]:[],!0),w?[i.shift({padding:16})]:[],!0),c?[i.arrow({element:p,padding:2})]:[],!0),[i.size({apply:function(t){t.width,t.height,t.reference,t.floating}}),i.hide()],!1)}),[4,i.computePosition(h,u,g)];case 1:return[2,v.sent()]}}))}))},u=function(t,i,o,n,r,s){return e.__awaiter(void 0,void 0,void 0,(function(){var d,u,h,f,w,g,v,b,m,x,_,y,E,S;return e.__generator(this,(function(e){switch(e.label){case 0:return u=void 0===(d={}.toShift)||d,h=t.placement,f=t.hideOnReferenceHidden,w=t.offset,g=t.hideOnTooltipEscape,v=t.arrowSizeScale,b=t.resetPlacementOnUpdate,m=t.arrow,x=t.scrollIntoView,_=t.showOnCreate,y=a(i).arrow,E=!i._instance.getState().fui,o?[4,p({passedPlacement:h,toResetPosition:r,passedOffset:w,resetPlacementOnUpdate:b,toShift:u,toShowArrow:m,arrowElement:y,tooltipElement:i,target:o,newlyShown:E})]:[2,console.warn("target element not found")];case 1:return function(t){var e,i,o,n=t.fui,r=t.newlyShown,s=t.scrollIntoView,a=t.hideOnReferenceHidden,d=t.hideOnTooltipEscape,p=t.tooltipElement,u=t.arrowElement,h=t.target,f=t.toHide,w=t.showOnCreate,g=t.arrowSizeScale,v=n.x,b=n.y,m=n.placement,x=n.middlewareData,_=x.hide,y=_.referenceHidden,E=_.escaped;y&&r&&s&&h.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),x.arrow&&(i=x.arrow.x,o=x.arrow.y);var S=0!==x.arrow.centerOffset,O=a&&y||d&&E||f?"hidden":"visible";console.log("to change visibility to: "+O),"visible"===O&&r&&!w&&(O="hidden"),l(p,O),Object.assign(p.style,{left:v+"px",top:b+"px"});var C=12*g;console.log("size scale: "+g),console.log("arrow size: "+C);var T=c[m.split("-")[0]],k=0,H=0,A=0;switch(A=null!==i?i+C+"px":"",T){case"top":k=1/1.7,k=.5,A=null!==i?i+C*k+"px":"";break;case"bottom":k=.5,A=null!==i?i+C*k+"px":"";break;case"left":k=.005,A=null!==i?i+"px":"",H=null!==o?o-C*k/2+"px":"";break;case"right":k=1,A=null!==i?i+"px":"",H=null!==o?o-C*k/2+"px":""}H=null!==o?o-C*k/2+"px":"",H=null!==o?o+"px":"",Object.assign(u.style,((e={visibility:S?"hidden":"visible",left:A,top:H,right:"",bottom:"",width:C+"px",height:C+"px"})[T]="-"+C*k+"px",e))}({fui:S=e.sent(),newlyShown:E,scrollIntoView:x,hideOnReferenceHidden:f,hideOnTooltipEscape:g,tooltipElement:i,arrowElement:y,target:o,toHide:n,showOnCreate:_,arrowSizeScale:v}),s({fui:S}),[2,S]}}))}))},h={allowHTML:!0,content:"",arrow:!0,scrollIntoView:!1,transitionDuration:[300,250],offset:[0,0],factorArrowInOffset:!0,hideOnClick:!0,onClickOutside:function(t,e){},onShow:function(t){},onHide:function(t){},onStateChange:function(t,e){},onRemove:function(){},onBeforeFirstRender:function(){},onAfterFirstRender:function(){},placement:{position:"top",orientation:"fixed"},resetPlacementOnUpdate:!1,hideOnTooltipEscape:!0,hideOnReferenceHidden:!0,showOnCreate:!0,maxWidth:350,updateDebounce:100,zIndex:99999,arrowSizeScale:1,updateOnEvents:"resize scroll"};var f=function(){function t(t,e){var i,o=this;this.state={isShown:!1,isRemoved:!1,fui:void 0},this.updateListenerCleanup=function(){},this.toHideTooltip=!1,this.transitionDuration=0,this.clickHandler=function(t){o.state.isShown&&(o.tooltipElement.contains(t.target)||o.reference.contains(t.target)||o.props.onClickOutside&&o.props.onClickOutside(o,t),"target"===o.props.hideOnClick?t.target===o.reference&&o.hide():o.props.hideOnClick&&o.hide())},this.props=t,this.reference=e,window.tp=this,(i=document.createElement("style")).type="text/css",i.setAttribute("floating-ui-tooltip-default",""),i.textContent=".floating-ui-tooltip-root{--color:#fff;--border-color:#fefefe;--border-color:red;backface-visibility:hidden;background:var(--color);border-radius:6px;box-shadow:0 0 0 1px rgba(6,44,82,.1),0 2px 16px rgba(33,43,54,.08);box-shadow:0 0 20px 4px rgba(154,161,177,.15),0 4px 80px -8px rgba(36,40,47,.25),0 4px 4px -2px rgba(91,94,105,.15);display:flex;font-size:90%;line-height:0px;margin:0;max-width:calc(100vw - 10px);padding:0;position:absolute;transition-duration:.2s;transition-property:transform,visibility,opacity;transition-timing-function:cubic-bezier(.54,1.5,.38,1.11);z-index:9999}.floating-ui-tooltip-arrow{box-shadow:0 0 0 1px rgba(6,44,82,.1),0 2px 16px rgba(33,43,54,.08);height:14px;position:absolute;transform:translateX(-50%) rotate(45deg);width:14px;z-index:-1}.floating-ui-tooltip-box{border-radius:inherit;line-height:normal;margin:0;outline:0;position:relative}.floating-ui-tooltip-root[data-state=hidden]{opacity:0}.floating-ui-tooltip-root[data-state=visible]{opacity:1}.floating-ui-tooltip-content{background-color:#fff;border-radius:inherit;color:#111;padding:0;position:relative;z-index:2}.floating-ui-tooltip-arrow,.floating-ui-tooltip-root{background:var(--color)}",document.head.appendChild(i),this.toHideTooltip=!this.props.showOnCreate}return t.prototype.hookEventListeners=function(){var t,e,o,n=this;this.debouncedUpdate=(t=this.update.bind(this),0===(e=this.props.updateDebounce)?t:function(i){clearTimeout(o),o=setTimeout((function(){t(i)}),e)});var r=i.autoUpdate(this.reference,this.tooltipElement,(function(){return n.debouncedUpdate(void 0)})),s=function(){return n.debouncedUpdate(void 0)};this.props.updateOnEvents.split(" ").forEach((function(t){window.addEventListener(t,s)})),window.addEventListener("click",this.clickHandler.bind(this)),this.updateListenerCleanup=function(){r(),window.removeEventListener("click",n.clickHandler.bind(n)),n.props.updateOnEvents.split(" ").forEach((function(t){window.removeEventListener(t,s)}))}},t.prototype.updateTransitionDuration=function(t){this.transitionDuration=t,this.tooltipElement.style.transitionDuration=t+"ms"},t.prototype.create=function(){return e.__awaiter(this,void 0,void 0,(function(){var t,i,o,l,c,d=this;return e.__generator(this,(function(p){switch(p.label){case 0:return this.tooltipElement=(h=this,f=s(),w=s(),g=s(),v=s(),f.className="floating-ui-tooltip-root",w.className="floating-ui-tooltip-box",g.className="floating-ui-tooltip-content",v.className="floating-ui-tooltip-arrow",w.appendChild(g),w.appendChild(v),f.appendChild(w),Object.assign(g.style,{maxWidth:h.props.maxWidth+"px"}),w.setAttribute("role","tooltip"),r(f,"hidden"),n(f,"hidden"),Object.assign(f.style,{zIndex:h.props.zIndex,visibility:"hidden",left:"0px",top:"0px"}),f._instance=h,f),this.updateTransitionDuration(this.props.transitionDuration[this.toHideTooltip?0:1]),t=a(this.tooltipElement).content,i=this.props,o=i.allowHTML,l=i.content,o?l instanceof Element?t.appendChild(l):t.innerHTML=l:l instanceof Element||(t.innerText=l),document.body.appendChild(this.tooltipElement),this.props.onBeforeFirstRender(),c=function(){return e.__awaiter(d,void 0,void 0,(function(){return e.__generator(this,(function(t){switch(t.label){case 0:return[4,u(this.props,this.tooltipElement,this.reference,this.toHideTooltip,!0,this.setState.bind(this))];case 1:case 2:return t.sent(),[4,this.update(!1,!0)];case 3:return t.sent(),this.hookEventListeners(),[2]}}))}))},[4,c()];case 1:return p.sent(),this.props.showOnCreate?[4,this.show()]:[3,3];case 2:return p.sent(),[3,5];case 3:return[4,this.hide()];case 4:p.sent(),p.label=5;case 5:return this.props.onAfterFirstRender(),[2]}var h,f,w,g,v}))}))},t.prototype.getState=function(){return this.state},t.prototype.setState=function(t){void 0!==t.isShown&&t.isShown!==this.state.isShown&&this.updateTransitionDuration(this.props.transitionDuration[t.isShown?1:0]),this.props.onStateChange(this.state,t),this.state=e.__assign(e.__assign({},this.state),t)},t.prototype.update=function(t,i){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(e){switch(e.label){case 0:return t=t||this.toHideTooltip||!1,[4,u(this.props,this.tooltipElement,this.reference,t,i,this.setState.bind(this))];case 1:return e.sent(),[2]}}))}))},t.prototype.hide=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(t){switch(t.label){case 0:return this.toHideTooltip=!0,[4,this.update(!0)];case 1:return t.sent(),[2]}}))}))},t.prototype.show=function(){return e.__awaiter(this,void 0,void 0,(function(){return e.__generator(this,(function(t){switch(t.label){case 0:return this.toHideTooltip=!1,[4,this.update(!1)];case 1:return t.sent(),[2]}}))}))},t.prototype.remove=function(){this.tooltipElement.remove(),this.state={isShown:!1,isRemoved:!0,fui:void 0},this.updateListenerCleanup(),console.log("removed all event listeners and observers"),this.props.onRemove()},t}();t.DEFAULT_ARROW_SIZE=12,t.default=function(t,i){return e.__awaiter(this,void 0,void 0,(function(){var o,n,r,s,a,l;return e.__generator(this,(function(c){switch(c.label){case 0:return o=i.placement||h.placement,n=i.transitionDuration||h.transitionDuration,r=i.offset||h.offset,Object.keys(i).forEach((function(t){return void 0===i[t]&&delete i[t]})),(s=e.__assign(e.__assign(e.__assign({},h),i),{placement:o,transitionDuration:n,offset:r})).factorArrowInOffset=s.arrow&&s.factorArrowInOffset,s.factorArrowInOffset&&(a=12*s.arrowSizeScale,s.offset[0]=s.offset[0]+a*Math.sqrt(2)/2),[4,(l=new f(s,t)).create()];case 1:return c.sent(),[2,{props:l.props,reference:l.reference,tooltipElement:l.tooltipElement,getState:l.getState.bind(l),show:l.show.bind(l),hide:l.hide.bind(l),remove:l.remove.bind(l),update:l.update.bind(l)}]}}))}))},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
